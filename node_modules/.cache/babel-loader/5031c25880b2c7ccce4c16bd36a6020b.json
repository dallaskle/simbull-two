{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'./Holdings.css';import{Link}from'react-router-dom';import{db}from'../../services/firebase';import firebase from'firebase';var OpenAsks=function OpenAsks(props){//props\nvar user=props.user;var teams=props.teams;//states\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),myAsks=_useState2[0],setMyAsks=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),asksLoaded=_useState4[0],setAsksLoaded=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),myAsksInd=_useState6[0],setMyAsksInd=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),show=_useState8[0],setShow=_useState8[1];//Functionality\nvar getMyAsks=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var myAsks1,myAsks2,myAsksTeams;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(show&&!asksLoaded)){_context.next=8;break;}if(!(user!==0)){_context.next=8;break;}myAsks1=[];myAsks2=[];myAsksTeams=[];_context.next=7;return db.collection('Asks').where('askOwner','==',user.email).get().then(function(snapshot){snapshot.forEach(function(doc){var data=doc.data();myAsks1.push(data);if(!myAsksTeams.includes(data.team)){myAsksTeams.push(data.team);}});myAsksTeams.map(function(x){var thisTeam;var thisAskPrice=0;var thisAskNumOfShares=0;var thisAskShare=[];var thisTeamLowestAskPrice;myAsks1.map(function(a){if(a.team==x){thisTeam=x;thisAskPrice=thisAskPrice+a.askPrice;thisAskNumOfShares=thisAskNumOfShares+1;thisAskShare.push(a.askShare);}});myAsks2.push({team:thisTeam,askPrice:thisAskPrice/thisAskNumOfShares,askNumOfShares:thisAskNumOfShares,askShares:thisAskShare});});setMyAsksInd(myAsks1);setMyAsks(myAsks2);});case 7:setAsksLoaded(true);case 8:case\"end\":return _context.stop();}}},_callee);}));return function getMyAsks(){return _ref.apply(this,arguments);};}();useEffect(function(){getMyAsks();},[show]);var showAsks=function showAsks(){function deleteAsks(_x){return _deleteAsks.apply(this,arguments);}function _deleteAsks(){_deleteAsks=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(l){var last,thisNumOfAsks,thisAvgAskPrice,batch;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:alert(\"Your asks are being deleted\");last=0;teams.map(function(t){if(t.team==l.team){thisNumOfAsks=t.asksAvailable;thisAvgAskPrice=t.avgAskPrice;}});batch=db.batch();myAsksInd.map(function(s){if(s.team==l.team){var thisRef1=db.collection('Asks').doc(\"\".concat(s.askShare,\"-\").concat(user.email));batch.delete(thisRef1);var thisRef2=db.collection('Shares').doc(s.askShare);batch.update(thisRef2,{currentAsk:null,onTradingBlock:false});var newNumOfAsks=thisNumOfAsks-l.askNumOfShares;last++;if(last=myAsksInd.length){var thisRef3=db.collection('Teams').doc(l.team);batch.update(thisRef3,{asksAvailable:newNumOfAsks,totalAskPrice:firebase.firestore.FieldValue.increment(-(l.askNumOfShares*l.askPrice))});}}});batch.commit().then(function(){alert('Deleted!');}).catch(function(error){return console.log(error);});setMyAsks(myAsks.filter(function(x){return x.team!=l.team;}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _deleteAsks.apply(this,arguments);}return myAsks.map(function(l){return/*#__PURE__*/_jsxs(\"div\",{className:\"holdings-offers-team-div\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"holdings-offers-team-name\",children:[\" \",/*#__PURE__*/_jsx(\"span\",{className:\"offers-orange-ask\",children:\"Ask\"}),/*#__PURE__*/_jsx(\"span\",{className:\"tc-name-sim\",children:\"sim\"}),l.team]}),/*#__PURE__*/_jsxs(\"div\",{className:\"holdings-offers-team-right\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"holdings-offers-team-info\",children:\"\".concat(l.askNumOfShares,\" x $\").concat(l.askPrice.toFixed(2))}),/*#__PURE__*/_jsx(\"button\",{className:\"holdings-offers-team-btn\",onClick:function onClick(){deleteAsks(l);},children:\"cancel\"})]})]},l.team);});};return/*#__PURE__*/_jsxs(\"div\",{className:\"OpenAsks\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"holdings-offers-div\",children:/*#__PURE__*/_jsxs(Link,{onClick:function onClick(){setShow(!show);},className:asksLoaded?\"blk-txt\":'',to:\"#\",children:[asksLoaded?'':'Open',\" Offers to Sell\"]})}),asksLoaded&&show&&showAsks(),myAsks.length==0&&asksLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"Portfolio-Team-Name\",children:\"You have no current offers to sell\"})]});};export default OpenAsks;","map":{"version":3,"sources":["C:/Users/Dallas/Desktop/simbull-two/src/components/Holdings/OpenAsks.js"],"names":["React","useState","useEffect","Link","db","firebase","OpenAsks","props","user","teams","myAsks","setMyAsks","asksLoaded","setAsksLoaded","myAsksInd","setMyAsksInd","show","setShow","getMyAsks","myAsks1","myAsks2","myAsksTeams","collection","where","email","get","then","snapshot","forEach","doc","data","push","includes","team","map","x","thisTeam","thisAskPrice","thisAskNumOfShares","thisAskShare","thisTeamLowestAskPrice","a","askPrice","askShare","askNumOfShares","askShares","showAsks","deleteAsks","l","alert","last","t","thisNumOfAsks","asksAvailable","thisAvgAskPrice","avgAskPrice","batch","s","thisRef1","delete","thisRef2","update","currentAsk","onTradingBlock","newNumOfAsks","length","thisRef3","totalAskPrice","firestore","FieldValue","increment","commit","catch","error","console","log","filter","toFixed"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport './Holdings.css'\r\nimport {Link} from 'react-router-dom'\r\nimport { db } from '../../services/firebase'\r\nimport firebase from 'firebase'\r\n\r\nconst OpenAsks = (props) => {\r\n    //props\r\n    const user = props.user\r\n    const teams = props.teams\r\n\r\n    //states\r\n    const [myAsks, setMyAsks] = useState([])\r\n    const [asksLoaded, setAsksLoaded] = useState(false)\r\n    const [myAsksInd, setMyAsksInd] = useState([])\r\n    const [show, setShow] = useState(false)\r\n\r\n    //Functionality\r\n    const getMyAsks = async () => {\r\n        if(show && !asksLoaded){\r\n            if(user !== 0){\r\n                const myAsks1 = []\r\n                const myAsks2 = []\r\n                const myAsksTeams =[]\r\n                await db.collection('Asks').where('askOwner', '==', user.email).get().then((snapshot) => {\r\n                    snapshot.forEach((doc) => {\r\n                        const data = doc.data()\r\n                        myAsks1.push(data)\r\n                        if(!myAsksTeams.includes(data.team)){\r\n                            myAsksTeams.push(data.team)\r\n                        }\r\n                    })\r\n                    myAsksTeams.map(x=> {\r\n                        let thisTeam\r\n                        let thisAskPrice = 0\r\n                        let thisAskNumOfShares = 0\r\n                        let thisAskShare =[]\r\n                        let thisTeamLowestAskPrice\r\n                        myAsks1.map(a => {\r\n                            if(a.team == x){\r\n                                thisTeam = x\r\n                                thisAskPrice = thisAskPrice + a.askPrice\r\n                                thisAskNumOfShares = thisAskNumOfShares + 1\r\n                                thisAskShare.push(a.askShare)\r\n                            }\r\n                        })\r\n                        myAsks2.push({\r\n                            team: thisTeam,\r\n                            askPrice: thisAskPrice/thisAskNumOfShares,\r\n                            askNumOfShares: thisAskNumOfShares,\r\n                            askShares: thisAskShare,\r\n                        })\r\n                    })\r\n                    setMyAsksInd(myAsks1)\r\n                    setMyAsks(myAsks2)\r\n                })\r\n                setAsksLoaded(true)\r\n            }\r\n        }\r\n    }\r\n    useEffect(() => {\r\n        getMyAsks()\r\n    }, [show])\r\n\r\n    const showAsks = () => {\r\n        async function deleteAsks(l){\r\n            alert(`Your asks are being deleted`)\r\n            let last = 0\r\n            let thisNumOfAsks \r\n            let thisAvgAskPrice \r\n            teams.map(t => {\r\n                if(t.team == l.team){\r\n                    thisNumOfAsks = t.asksAvailable\r\n                    thisAvgAskPrice = t.avgAskPrice\r\n                }\r\n            })\r\n            var batch = db.batch()\r\n            myAsksInd.map(s => {\r\n                if(s.team == l.team){\r\n                    let thisRef1 = db.collection('Asks').doc(`${s.askShare}-${user.email}`)\r\n                    batch.delete(thisRef1)\r\n                    let thisRef2 = db.collection('Shares').doc(s.askShare)\r\n                    batch.update(thisRef2, {\r\n                        currentAsk: null,\r\n                        onTradingBlock: false\r\n                    })\r\n                    let newNumOfAsks = thisNumOfAsks - l.askNumOfShares\r\n                    last++\r\n                    if(last = myAsksInd.length){\r\n                        let thisRef3 = db.collection('Teams').doc(l.team)\r\n                        batch.update(thisRef3, {\r\n                            asksAvailable: newNumOfAsks,\r\n                            totalAskPrice: firebase.firestore.FieldValue.increment(-(l.askNumOfShares * l.askPrice)),\r\n                        })\r\n                    }\r\n                }\r\n            })\r\n            batch.commit().then(() => {alert('Deleted!')}).catch((error) => console.log(error));\r\n            setMyAsks(myAsks.filter(x => {return(x.team != l.team)}))\r\n        }\r\n        return(\r\n        myAsks.map(l => {\r\n            return(\r\n                <div className=\"holdings-offers-team-div\" key={l.team}>\r\n                    <div className=\"holdings-offers-team-name\"> <span className='offers-orange-ask'>Ask</span><span className=\"tc-name-sim\">sim</span>{l.team}</div>\r\n                    <div className=\"holdings-offers-team-right\">\r\n                        <span className=\"holdings-offers-team-info\">{`${l.askNumOfShares} x $${l.askPrice.toFixed(2)}`}</span> \r\n                        <button className=\"holdings-offers-team-btn\" onClick={()=>{deleteAsks(l)}}>cancel</button>\r\n                    </div> \r\n               </div>\r\n            )\r\n        })\r\n        )\r\n    }\r\n\r\n    return(\r\n        <div className=\"OpenAsks\">\r\n            <div className=\"holdings-offers-div\"><Link onClick={()=>{setShow(!show)}} className={asksLoaded ? \"blk-txt\" : ''} to=\"#\">{asksLoaded ? '' : 'Open'} Offers to Sell</Link></div>\r\n                {asksLoaded && show && showAsks()}\r\n                {myAsks.length == 0 && asksLoaded && <div className=\"Portfolio-Team-Name\">You have no current offers to sell</div>}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default OpenAsks"]},"metadata":{},"sourceType":"module"}