{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'./functions.css';import{Link}from'react-router-dom';import{db}from'../../services/firebase';import firebase from'firebase';import moment from'moment';var CreateAsk=function CreateAsk(props){//props\nvar shares=props.shares;var team=props.team;var user=props.user;var closeAsk=props.closeAsk;//states\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),calc=_useState2[0],setCalc=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),showShare=_useState4[0],setShowShare=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showPrice=_useState6[0],setShowPrice=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),askPrice=_useState8[0],setAskPrice=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),askSharesAmount=_useState10[0],setAskSharesAmount=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),numAvailableShares=_useState12[0],setNumAvailableShares=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),availableShares=_useState14[0],setAvailableShares=_useState14[1];var sharesHold=[];var today=moment().format('YYYYMMDD');//Functionality\n//calc add digit\nvar addDigit=function addDigit(x){console.log(calc);if(x==='.'&&calc.substring(calc.length-1,calc.length)==='.'){return null;}else{if(showShare){var hold=calc;var thisNum=hold.concat(x);console.log(thisNum);setAskSharesAmount(parseFloat(thisNum));setCalc(thisNum);}else if(showPrice){var _hold=calc;var _thisNum=_hold.concat(x);console.log(_thisNum);setAskPrice(parseFloat(_thisNum));setCalc(_thisNum);}}};var deleteDigit=function deleteDigit(){if(showShare){var editedText=calc.slice(0,-1);setAskSharesAmount(parseFloat(editedText));setCalc(editedText);}else if(showPrice){var _editedText=calc.slice(0,-1);setAskPrice(parseFloat(_editedText));setCalc(_editedText);}};function createAsk(){var numShares=0;var totalPrice=0;db.collection('Bids').where('bidTeam','==',team.team).get().then(function(snapshot){snapshot.forEach(function(doc){var data=doc.data();if(data.email!=user.email){if(data.bidPrice>=askPrice){numShares++;if(numShares<=askSharesAmount){totalPrice=totalPrice+data.bidPrice;}}}});if(numShares>=askSharesAmount&&totalPrice>=askSharesAmount*askPrice){var stillCreate=window.confirm(\"There are enough open bids to fill your order! You can sell your shares for $\".concat((totalPrice/askSharesAmount).toFixed(2),\" per share. Would you still like to create the offer to sell?\"));if(stillCreate){if(availableShares.length>=askSharesAmount){//if you have enough shares available to offer \nvar batch=db.batch();for(var i=0;i<askSharesAmount;i++){//gets the right number\nvar share=availableShares[i];//going through the array\nvar thisRef1=db.collection('Asks').doc(\"\".concat(share,\"-\").concat(user.email));batch.set(thisRef1,{//creates a doc in Asks DB\naskPrice:parseFloat(askPrice),askOwner:user.email,askShare:share,team:team.team,subscription:user.subscription,askNum:i,time:firebase.firestore.Timestamp.now(),date:today});var thisRef2=db.collection('Shares').doc(share);batch.update(thisRef2,{onTradingBlock:true,currentAsk:parseFloat(askPrice)});var thisRef3=db.collection('Teams').doc(team.team);batch.update(thisRef3,{asksAvailable:firebase.firestore.FieldValue.increment(1),totalAskPrice:firebase.firestore.FieldValue.increment(parseFloat(askPrice))//lowestAskPrice: parseFloat(askPrice) < firebase.firestore.FieldValue  ?  firebase.firestore.FieldValue : parseFloat(askPrice) \n});}batch.commit().then(function(){alert(\"You created an offer to sell \".concat(askSharesAmount,\" shares for a price per share of $\").concat(askPrice));window.location.href=\"http://simbull.app\";}).catch(function(error){return console.log(error);});}else{alert('you dont have enough shares or your shares are already in an offer to sell');}}}else{var answer=window.confirm(\"Do you want to create an offer to sell \".concat(askSharesAmount,\" shares for a price per share of $\").concat(askPrice,\"?\"));if(answer){console.log(availableShares);if(availableShares.length>=askSharesAmount){//if you have enough shares available to offer \nvar batch=db.batch();for(var _i=0;_i<askSharesAmount;_i++){//gets the right number\nvar _share=availableShares[_i];//going through the array\nvar _thisRef=db.collection('Asks').doc(\"\".concat(_share,\"-\").concat(user.email));batch.set(_thisRef,{//creates a doc in Asks DB\naskPrice:parseFloat(askPrice),askOwner:user.email,askShare:_share,team:team.team,subscription:user.subscription,askNum:_i,time:firebase.firestore.Timestamp.now(),date:today});var _thisRef2=db.collection('Shares').doc(_share);batch.update(_thisRef2,{onTradingBlock:true,currentAsk:parseFloat(askPrice)});var _thisRef3=db.collection('Teams').doc(team.team);batch.update(_thisRef3,{asksAvailable:firebase.firestore.FieldValue.increment(1),totalAskPrice:firebase.firestore.FieldValue.increment(parseFloat(askPrice))//lowestAskPrice: parseFloat(askPrice) < firebase.firestore.FieldValue  ?  firebase.firestore.FieldValue : parseFloat(askPrice) \n});}batch.commit().then(function(){alert(\"You created an offer to sell \".concat(askSharesAmount,\" shares for a price per share of $\").concat(askPrice));console.log(availableShares);window.location.href=\"http://simbull.app\";}).catch(function(error){return console.log(error);});}else{alert('you dont have enough shares or your shares are already in an offer to sell');}//cycle through bids to see if you can fill any of them\n}}}).catch(function(error){return console.log(error);});}var getTeamShares=function getTeamShares(){user.shares.map(function(s){var sL=s.length;var newS=s.substring(0,sL-4);if(newS==team.team){sharesHold.push(s);}});getAskAvailability();return sharesHold.length;};function getAskAvailability(){console.log(sharesHold);var nas=0;var availableShares1=[];sharesHold.map(function(t){db.collection('Shares').doc(t).get().then(function(doc){var data=doc.data();console.log(data);if(data.onTradingBlock==false){availableShares1.push(t);nas=nas+1;}console.log(nas);});setAvailableShares(availableShares1);setNumAvailableShares(nas);return nas;});}useEffect(function(){getTeamShares();},[askSharesAmount]);return/*#__PURE__*/_jsx(\"div\",{className:\"TradePopup\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"SellShare\",children:[/*#__PURE__*/_jsx(Link,{onClick:closeAsk,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-times-circle\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"ss-title\",children:\"Offer to Sell\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-team\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"ss-img\",src:\"nba_jersey/\".concat(team.team,\".png\"),alt:\"team\"}),/*#__PURE__*/_jsx(\"span\",{className:\"tc-name-sim\",children:\"sim\"}),team.team]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-shares\",children:[\"You own \",shares,\" shares\"]}),showShare&&/*#__PURE__*/_jsxs(\"div\",{className:\"ss-shareAmt\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ss-share-label\",children:\"Shares:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"ss-shareAmt-underline\",children:calc?calc:'0'})]}),showPrice&&/*#__PURE__*/_jsxs(\"div\",{className:\"ss-shareAmt\",children:[/*#__PURE__*/_jsx(Link,{onClick:function onClick(){setShowPrice(false);setShowShare(true);setCalc('');setAskPrice();setAskSharesAmount();},children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-undo\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"ss-share-label\",children:\"Price:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"ss-shareAmt-underline\",children:calc?calc:'0.00'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-btn-div\",children:[showShare&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"center\",children:/*#__PURE__*/_jsx(\"button\",{className:\"ss-submit\",onClick:function onClick(){setShowPrice(true);setShowShare(false);setCalc('');},children:\"Next\"})})}),showPrice&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"center\",children:/*#__PURE__*/_jsx(\"button\",{className:\"ss-submit\",onClick:createAsk,children:\"Create Offer to Sell\"})})}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"1\");},children:\"1\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"2\");},children:\"2\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"3\");},children:\"3\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"4\");},children:\"4\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"5\");},children:\"5\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"6\");},children:\"6\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"7\");},children:\"7\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"8\");},children:\"8\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"9\");},children:\"9\"}),showPrice&&/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\".\");},children:\".\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"0\");},children:\"0\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn-2\",onClick:function onClick(){deleteDigit();},children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-arrow-left\"})})]})]})});};export default CreateAsk;","map":{"version":3,"sources":["C:/Users/Dallas/Desktop/simbull-two/src/components/Functionality/CreateAsk.js"],"names":["React","useState","useEffect","Link","db","firebase","moment","CreateAsk","props","shares","team","user","closeAsk","calc","setCalc","showShare","setShowShare","showPrice","setShowPrice","askPrice","setAskPrice","askSharesAmount","setAskSharesAmount","numAvailableShares","setNumAvailableShares","availableShares","setAvailableShares","sharesHold","today","format","addDigit","x","console","log","substring","length","hold","thisNum","concat","parseFloat","deleteDigit","editedText","slice","createAsk","numShares","totalPrice","collection","where","get","then","snapshot","forEach","doc","data","email","bidPrice","stillCreate","window","confirm","toFixed","batch","i","share","thisRef1","set","askOwner","askShare","subscription","askNum","time","firestore","Timestamp","now","date","thisRef2","update","onTradingBlock","currentAsk","thisRef3","asksAvailable","FieldValue","increment","totalAskPrice","commit","alert","location","href","catch","error","answer","getTeamShares","map","s","sL","newS","push","getAskAvailability","nas","availableShares1","t"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport './functions.css'\r\nimport {Link} from 'react-router-dom'\r\nimport {db} from '../../services/firebase'\r\nimport firebase from 'firebase'\r\nimport moment from 'moment'\r\n\r\nconst CreateAsk = (props) => {\r\n    //props\r\n    const shares = props.shares\r\n    const team = props.team\r\n    const user = props.user\r\n    const closeAsk = props.closeAsk\r\n\r\n    //states\r\n    const [calc, setCalc] = useState('')\r\n    const [showShare, setShowShare] = useState(true)\r\n    const [showPrice, setShowPrice] = useState(false)\r\n    const [askPrice, setAskPrice] = useState()\r\n    const [askSharesAmount, setAskSharesAmount] = useState()\r\n    const [numAvailableShares, setNumAvailableShares] = useState(0)\r\n    const [availableShares, setAvailableShares] = useState([])\r\n\r\n    const sharesHold = []\r\n\r\n    let today = moment().format('YYYYMMDD')\r\n\r\n    //Functionality\r\n    //calc add digit\r\n    const addDigit = (x) => {\r\n        console.log(calc)\r\n        if(x === '.' && calc.substring(calc.length - 1, calc.length) === '.'){\r\n            return null\r\n        }else{\r\n            if(showShare){\r\n                let hold = calc\r\n                let thisNum = hold.concat(x)\r\n                console.log(thisNum)\r\n                setAskSharesAmount(parseFloat(thisNum))\r\n                setCalc(thisNum)\r\n            }else if(showPrice){\r\n                let hold = calc\r\n                let thisNum = hold.concat(x)\r\n                console.log(thisNum)\r\n                setAskPrice(parseFloat(thisNum))\r\n                setCalc(thisNum)\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    const deleteDigit = () => {\r\n        if(showShare){\r\n            const editedText = calc.slice(0, -1)\r\n            setAskSharesAmount(parseFloat(editedText))\r\n            setCalc(editedText)\r\n        }else if(showPrice){\r\n            const editedText = calc.slice(0, -1)\r\n            setAskPrice(parseFloat(editedText))\r\n            setCalc(editedText)\r\n        }\r\n        \r\n    }\r\n\r\n    function createAsk() {\r\n        let numShares = 0\r\n        let totalPrice = 0\r\n        db.collection('Bids').where('bidTeam', '==', team.team).get().then((snapshot) => {\r\n            snapshot.forEach((doc) => {\r\n              const data = doc.data();\r\n              if(data.email != user.email){\r\n                if(data.bidPrice >= askPrice){\r\n                    numShares++\r\n                    if(numShares <= askSharesAmount){\r\n                        totalPrice = totalPrice + data.bidPrice\r\n                    }\r\n                }\r\n              }\r\n            });\r\n            if(numShares >= askSharesAmount && totalPrice >= (askSharesAmount * askPrice)){\r\n                let stillCreate = window.confirm(`There are enough open bids to fill your order! You can sell your shares for $${(totalPrice/askSharesAmount).toFixed(2)} per share. Would you still like to create the offer to sell?`)\r\n                if(stillCreate){\r\n                    if(availableShares.length >= askSharesAmount){ //if you have enough shares available to offer \r\n                        var batch = db.batch()\r\n                        for(let i = 0; i < askSharesAmount; i++){ //gets the right number\r\n                            let share = availableShares[i] //going through the array\r\n                            \r\n                            let thisRef1 = db.collection('Asks').doc(`${share}-${user.email}`)\r\n                            batch.set(thisRef1, { //creates a doc in Asks DB\r\n                                askPrice: parseFloat(askPrice),\r\n                                askOwner: user.email,\r\n                                askShare: share,\r\n                                team: team.team,\r\n                                subscription: user.subscription,\r\n                                askNum: i,\r\n                                time: firebase.firestore.Timestamp.now(),\r\n                                date: today\r\n                            })\r\n                            let thisRef2 = db.collection('Shares').doc(share)\r\n                            batch.update(thisRef2, {\r\n                                onTradingBlock: true,\r\n                                currentAsk: parseFloat(askPrice)\r\n                            })\r\n                            let thisRef3 = db.collection('Teams').doc(team.team)\r\n                            batch.update(thisRef3, {\r\n                                asksAvailable: firebase.firestore.FieldValue.increment(1),\r\n                                totalAskPrice: firebase.firestore.FieldValue.increment(parseFloat(askPrice)),\r\n                                //lowestAskPrice: parseFloat(askPrice) < firebase.firestore.FieldValue  ?  firebase.firestore.FieldValue : parseFloat(askPrice) \r\n                            })\r\n                        }\r\n                        batch.commit().then(()=> {\r\n                            alert(`You created an offer to sell ${askSharesAmount} shares for a price per share of $${askPrice}`)\r\n                            window.location.href = \"http://simbull.app\";\r\n                        }).catch((error) => console.log(error));\r\n                    }\r\n                    else{alert('you dont have enough shares or your shares are already in an offer to sell')}\r\n                }\r\n            }\r\n            else{\r\n                let answer = window.confirm(`Do you want to create an offer to sell ${askSharesAmount} shares for a price per share of $${askPrice}?`)\r\n                if(answer){\r\n                    console.log(availableShares)\r\n                    if(availableShares.length >= askSharesAmount){ //if you have enough shares available to offer \r\n                        var batch = db.batch()\r\n                        for(let i = 0; i < askSharesAmount; i++){ //gets the right number\r\n                            let share = availableShares[i] //going through the array\r\n                            let thisRef1 = db.collection('Asks').doc(`${share}-${user.email}`)\r\n                            batch.set(thisRef1, { //creates a doc in Asks DB\r\n                                askPrice: parseFloat(askPrice),\r\n                                askOwner: user.email,\r\n                                askShare: share,\r\n                                team: team.team,\r\n                                subscription: user.subscription,\r\n                                askNum: i,\r\n                                time: firebase.firestore.Timestamp.now(),\r\n                                date: today\r\n                            })\r\n                            let thisRef2 = db.collection('Shares').doc(share)\r\n                            batch.update(thisRef2, {\r\n                                onTradingBlock: true,\r\n                                currentAsk: parseFloat(askPrice)\r\n                            })\r\n                            let thisRef3 = db.collection('Teams').doc(team.team)\r\n                            batch.update(thisRef3, {\r\n                                asksAvailable: firebase.firestore.FieldValue.increment(1),\r\n                                totalAskPrice: firebase.firestore.FieldValue.increment(parseFloat(askPrice)),\r\n                                //lowestAskPrice: parseFloat(askPrice) < firebase.firestore.FieldValue  ?  firebase.firestore.FieldValue : parseFloat(askPrice) \r\n                            })\r\n                        }\r\n                        batch.commit().then(()=> {\r\n                            alert(`You created an offer to sell ${askSharesAmount} shares for a price per share of $${askPrice}`)\r\n                            console.log(availableShares)\r\n                            window.location.href = \"http://simbull.app\";\r\n                        }).catch((error) => console.log(error));\r\n                    }\r\n                    else{alert('you dont have enough shares or your shares are already in an offer to sell')}\r\n                    //cycle through bids to see if you can fill any of them\r\n                }\r\n            }\r\n            \r\n          })\r\n          .catch((error) => console.log(error));\r\n    }\r\n    const getTeamShares = () => {\r\n        user.shares.map(s => {\r\n            let sL = s.length\r\n            let newS = s.substring(0, sL - 4)\r\n            if(newS == team.team){sharesHold.push(s)}\r\n        })\r\n        getAskAvailability()\r\n        return(sharesHold.length)\r\n    }\r\n    function getAskAvailability() {\r\n            console.log(sharesHold)\r\n            let nas = 0\r\n            let availableShares1 = []\r\n            sharesHold.map(t => {\r\n                db.collection('Shares').doc(t).get().then((doc) => {\r\n                        const data = doc.data()\r\n                        console.log(data)\r\n                        if(data.onTradingBlock == false){\r\n                            availableShares1.push(t)\r\n                            nas = nas + 1\r\n                        } \r\n                        console.log(nas)\r\n                })\r\n                setAvailableShares(availableShares1)\r\n                setNumAvailableShares(nas)\r\n                return nas\r\n            })\r\n    }\r\n    useEffect(() => {\r\n        getTeamShares()\r\n    }, [askSharesAmount])\r\n\r\n    return(\r\n        <div className=\"TradePopup\">\r\n            <div className=\"SellShare\">\r\n                <Link onClick={closeAsk}><i className=\"fa fa-times-circle\"></i></Link>\r\n                <div className=\"ss-title\">Offer to Sell</div>\r\n                <div className='ss-team'><img className=\"ss-img\"  src={`nba_jersey/${team.team}.png`} alt='team' /><span className=\"tc-name-sim\">sim</span>{team.team}</div>\r\n                <div className='ss-shares'>You own {shares} shares</div>\r\n                {showShare && <div className=\"ss-shareAmt\"><span className=\"ss-share-label\">Shares:</span> <span className=\"ss-shareAmt-underline\">{calc ? calc : '0'}</span></div>}\r\n                {showPrice && <div className=\"ss-shareAmt\"><Link onClick={()=>{setShowPrice(false);setShowShare(true);setCalc('');setAskPrice();setAskSharesAmount()}}><i className=\"fa fa-undo\"></i></Link><span className=\"ss-share-label\">Price:</span> <span className=\"ss-shareAmt-underline\">{calc ? calc : '0.00'}</span></div>}\r\n                <div className=\"ss-btn-div\">\r\n                    {showShare && <><div className=\"center\"><button className=\"ss-submit\" onClick={()=>{setShowPrice(true);setShowShare(false);setCalc('')}}>Next</button></div></>}\r\n                    {showPrice && <><div className=\"center\"><button className=\"ss-submit\" onClick={createAsk}>Create Offer to Sell</button></div></>}\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"1\")}}>1</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"2\")}}>2</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"3\")}}>3</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"4\")}}>4</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"5\")}}>5</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"6\")}}>6</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"7\")}}>7</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"8\")}}>8</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"9\")}}>9</button>\r\n                    {showPrice && <button className=\"ss-btn\" onClick={()=>{addDigit(\".\")}}>.</button>}\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"0\")}}>0</button>\r\n                    <button className=\"ss-btn-2\" onClick={()=>{deleteDigit()}}><i className=\"fa fa-arrow-left\"></i></button>\r\n                </div>\r\n            </div> \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default CreateAsk"]},"metadata":{},"sourceType":"module"}