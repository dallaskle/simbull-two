{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Dallas\\\\Desktop\\\\simbull-two\\\\src\\\\components\\\\Functionality\\\\BuyShare.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport './functions.css';\nimport { Link } from 'react-router-dom';\nimport { db } from '../../services/firebase';\nimport firebase from 'firebase';\nimport moment from 'moment';\n\nconst BuyShare = props => {\n  _s();\n\n  //props\n  const team = props.team;\n  const user = props.user;\n  const closeBuy = props.closeBuy; //states\n\n  const [calc, setCalc] = useState('');\n  const [buyShares, setBuyShares] = useState(0);\n  const [asksArr1, setAsksArr1] = useState([]); //let buyShares = 0\n\n  let maxBuy = 7;\n  let totalCost;\n  let shareCost;\n  let tradingCost = 0;\n  let avgCost;\n  let newLowestAskPrice = 9999; //let asksArr1 = []\n  //Functionality\n  //calc add digit\n\n  const addDigit = x => {\n    let hold = calc;\n    let thisNum = hold.concat(x);\n    setBuyShares(parseFloat(thisNum));\n    setCalc(thisNum);\n    console.log(buyShares);\n    console.log(typeof buyShares);\n  };\n\n  const deleteDigit = () => {\n    const editedText = calc.slice(0, -1);\n    setBuyShares(parseFloat(editedText));\n    setCalc(editedText);\n  };\n\n  const submitBuy = () => {\n    console.log(buyShares);\n    let buyShareInt = parseInt(buyShares);\n\n    if (asksArr1.length > 0) {\n      shareCost = asksArr1[0].askPrice;\n    }\n\n    if (asksArr1.length >= buyShares) {\n      for (let i = 1; i < buyShares; i++) {\n        shareCost = shareCost + asksArr1[i].askPrice;\n      }\n\n      if (!user.subscription) {\n        tradingCost = 1;\n      }\n\n      avgCost = shareCost / buyShares;\n      totalCost = shareCost + tradingCost;\n    }\n\n    let count = 0;\n    user.shares.map(s => {\n      let share = s.substring(0, s.length - 4);\n\n      if (share == team.team) {\n        count++;\n      }\n    });\n    let buyAmt = 7 - count;\n    maxBuy = buyAmt;\n\n    if (buyShareInt == buyShares) {\n      if (asksArr1.length + 1 > buyShares) {\n        if (totalCost <= user.cash) {\n          if (buyShares <= maxBuy) {\n            let answer = window.confirm(`Are you sure you want to buy ${buyShares} shares for an average cost of $${avgCost.toFixed(2)} per share, for a total of $${totalCost.toFixed(2)}? ${tradingCost != 0 ? `Includes a trading fee of $${tradingCost.toFixed(2)}` : ''}`);\n\n            if (answer) {\n              alert(`You bought ${buyShares} shares for an average cost of $${avgCost.toFixed(2)} per share, for a total of $${totalCost.toFixed(2)}`);\n              uploadingByAsk();\n            } else {\n              resetIt();\n            }\n          } else {\n            alert(`Sorry, you can only own 7 shares of a specific team at the moment. ${maxBuy === 0 ? 'Since, you already own 7, it is not possible to buy more. We apologize for the inconvenience.' : `It is possible to buy ${maxBuy} more share(s).`}`);\n            resetIt();\n          }\n        } else {\n          alert(`You dont have enough cash`);\n          console.log(totalCost);\n          resetIt();\n        }\n      } else {\n        alert(`Not enough available shares. There are only ${asksArr1.length} shares available.`);\n        resetIt();\n      }\n    } else {\n      console.log(buyShares);\n      console.log(buyShareInt);\n      alert(`Sorry we don't do fractional trading. Please try again with a whole number.`);\n      resetIt();\n    }\n  };\n\n  const getTotalCost = () => {\n    if (asksArr1.length > 0) {\n      shareCost = asksArr1[0].askPrice;\n    }\n\n    if (asksArr1.length >= buyShares) {\n      for (let i = 1; i < buyShares; i++) {\n        shareCost = shareCost + asksArr1[i].askPrice;\n      }\n\n      if (!user.subscription) {\n        tradingCost = 1;\n      }\n\n      avgCost = shareCost / buyShares;\n      totalCost = shareCost + tradingCost;\n    }\n  };\n\n  useEffect(() => {\n    getTotalCost();\n  }, [buyShares, asksArr1]);\n\n  const checkShareAmt = () => {\n    if (user.shares) {\n      let count = 0;\n      user.shares.map(s => {\n        let share = s.substring(0, s.length - 4);\n\n        if (share == team.team) {\n          count++;\n        }\n      });\n      let buyAmt = 7 - count;\n      maxBuy = buyAmt;\n    }\n  };\n\n  useEffect(() => {\n    checkShareAmt();\n  }, [user]);\n\n  function uploadingByAsk() {\n    let transactionNum = `000000000000${(Math.random() * 100000000000).toFixed(0)}`;\n    let transactionID = transactionNum.substring(transactionNum.length - 10, transactionNum.length);\n    var batch = db.batch();\n\n    for (let i = 0; i < buyShares; i++) {\n      if (!asksArr1[i].subscription) {\n        let num = asksArr1[i].askNum;\n\n        if (num == 0) {\n          let thisRef7 = db.collection('Users').doc(asksArr1[i].askOwner);\n          batch.update(thisRef7, {\n            cash: firebase.firestore.FieldValue.increment(-tradingCost)\n          });\n        }\n      }\n\n      let thisRef1 = db.collection('Shares').doc(asksArr1[i].askShare);\n      batch.update(thisRef1, {\n        currentAsk: null,\n        lastSoldPrice: asksArr1[i].askPrice,\n        onTradingBlock: false,\n        owner: user.email,\n        totalPayouts: 0\n      });\n      let thisRef2 = db.collection('Users').doc(asksArr1[i].askOwner);\n      batch.update(thisRef2, {\n        cash: firebase.firestore.FieldValue.increment(asksArr1[i].askPrice),\n        shares: firebase.firestore.FieldValue.arrayRemove(asksArr1[i].askShare)\n      });\n      let thisRef3 = db.collection('Users').doc(user.email);\n      batch.update(thisRef3, {\n        shares: firebase.firestore.FieldValue.arrayUnion(asksArr1[i].askShare)\n      });\n      let thisRef4 = db.collection('Asks').doc(`${asksArr1[i].askShare}-${asksArr1[i].askOwner}`);\n      batch.delete(thisRef4);\n      let newYearHigh = team.yearHigh > asksArr1[i].askPrice ? team.yearHigh : asksArr1[i].askPrice;\n      let newYearLow = team.yearLow < asksArr1[i].askPrice ? team.yearLow : asksArr1[i].askPrice;\n      let thisRef5 = db.collection('Teams').doc(team.team);\n      batch.update(thisRef5, {\n        asksAvailable: firebase.firestore.FieldValue.increment(-1),\n        totalAskPrice: firebase.firestore.FieldValue.increment(parseFloat(-asksArr1[i].askPrice)),\n        lastSoldPrice: asksArr1[i].askPrice,\n        yearHigh: newYearHigh,\n        yearLow: newYearLow\n      });\n      let date = moment().format('YYYYMMDD');\n      let thisRef8 = db.collection('Transactions').doc(`${date}-${asksArr1[i].askShare}-seller:${asksArr1[i].askOwner}-buyer:${user.email}-price:${asksArr1[i].askPrice}`);\n      batch.set(thisRef8, {\n        seller: asksArr1[i].askOwner,\n        buyer: user.email,\n        price: asksArr1[i].askPrice,\n        date: date,\n        time: firebase.firestore.Timestamp.now(),\n        sellerFee: !asksArr1[i].subscription,\n        buyerFee: !user.subscription,\n        share: asksArr1[i].askShare,\n        transactionID: transactionID,\n        type: 'buy',\n        oldPrice: team.lastSoldPrice\n      });\n    }\n\n    let thisRef6 = db.collection('Users').doc(user.email);\n    batch.update(thisRef6, {\n      cash: firebase.firestore.FieldValue.increment(-totalCost)\n    });\n    batch.commit().then(() => {\n      return window.location.href = \"http://simbull.app\";\n    }).catch(error => console.log(error));\n  }\n\n  const resetIt = () => {\n    //setBuyShares()\n    setBuyShares(0);\n    totalCost = 0;\n    avgCost = 0;\n    newLowestAskPrice = 0;\n  };\n\n  const checkAsks = () => {\n    function compare(a, b) {\n      return a.askPrice - b.askPrice;\n    }\n\n    db.collection('Asks').where('team', '==', team.team).onSnapshot(querySnapshot => {\n      let asksArr = [];\n      querySnapshot.forEach(function (doc) {\n        const data = doc.data();\n\n        if (user.email != data.askOwner) {\n          asksArr.push(data);\n        }\n      });\n      asksArr.sort(compare);\n      setAsksArr1(asksArr);\n      console.log(asksArr1);\n    });\n  };\n\n  useEffect(() => {\n    checkAsks();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"TradePopup\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"SellShare\",\n      children: [/*#__PURE__*/_jsxDEV(Link, {\n        onClick: closeBuy,\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fa fa-times-circle\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 42\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ss-title\",\n        children: \"Buy\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ss-team\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          className: \"ss-img\",\n          src: `nba_jersey/${team.team}.png`,\n          alt: \"team\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 42\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"tc-name-sim\",\n          children: \"sim\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 116\n        }, this), team.team]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ss-cash\",\n        children: [\"Cash Available: $\", user.cash && user.cash.toFixed(2)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ss-shareAmt\",\n        children: calc ? calc : '0'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ss-btn-div\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-submit\",\n          onClick: submitBuy,\n          children: \"Buy\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 83\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"1\");\n          },\n          children: \"1\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"2\");\n          },\n          children: \"2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"3\");\n          },\n          children: \"3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"4\");\n          },\n          children: \"4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"5\");\n          },\n          children: \"5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"6\");\n          },\n          children: \"6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"7\");\n          },\n          children: \"7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"8\");\n          },\n          children: \"8\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"9\");\n          },\n          children: \"9\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn\",\n          onClick: () => {\n            addDigit(\"0\");\n          },\n          children: \"0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ss-btn-2\",\n          onClick: () => {\n            deleteDigit();\n          },\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-arrow-left\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 80\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 236,\n    columnNumber: 9\n  }, this);\n};\n\n_s(BuyShare, \"/RETd1uUPtZjOWm9cJ7p7BC8Bhg=\");\n\n_c = BuyShare;\nexport default BuyShare;\n\nvar _c;\n\n$RefreshReg$(_c, \"BuyShare\");","map":{"version":3,"sources":["C:/Users/Dallas/Desktop/simbull-two/src/components/Functionality/BuyShare.js"],"names":["React","useState","useEffect","Link","db","firebase","moment","BuyShare","props","team","user","closeBuy","calc","setCalc","buyShares","setBuyShares","asksArr1","setAsksArr1","maxBuy","totalCost","shareCost","tradingCost","avgCost","newLowestAskPrice","addDigit","x","hold","thisNum","concat","parseFloat","console","log","deleteDigit","editedText","slice","submitBuy","buyShareInt","parseInt","length","askPrice","i","subscription","count","shares","map","s","share","substring","buyAmt","cash","answer","window","confirm","toFixed","alert","uploadingByAsk","resetIt","getTotalCost","checkShareAmt","transactionNum","Math","random","transactionID","batch","num","askNum","thisRef7","collection","doc","askOwner","update","firestore","FieldValue","increment","thisRef1","askShare","currentAsk","lastSoldPrice","onTradingBlock","owner","email","totalPayouts","thisRef2","arrayRemove","thisRef3","arrayUnion","thisRef4","delete","newYearHigh","yearHigh","newYearLow","yearLow","thisRef5","asksAvailable","totalAskPrice","date","format","thisRef8","set","seller","buyer","price","time","Timestamp","now","sellerFee","buyerFee","type","oldPrice","thisRef6","commit","then","location","href","catch","error","checkAsks","compare","a","b","where","onSnapshot","querySnapshot","asksArr","forEach","data","push","sort"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport './functions.css'\r\nimport {Link} from 'react-router-dom'\r\nimport { db } from '../../services/firebase'\r\nimport firebase from 'firebase'\r\nimport moment from 'moment'\r\n\r\nconst BuyShare = (props) => {\r\n    //props\r\n    const team = props.team\r\n    const user = props.user\r\n    const closeBuy = props.closeBuy\r\n\r\n    //states\r\n    const [calc, setCalc] = useState('')\r\n    const [buyShares, setBuyShares] = useState(0)\r\n    const [asksArr1, setAsksArr1] = useState([])\r\n\r\n    //let buyShares = 0\r\n    let maxBuy = 7\r\n\r\n    let totalCost \r\n    let shareCost\r\n    let tradingCost = 0\r\n    let avgCost\r\n    let newLowestAskPrice = 9999\r\n    //let asksArr1 = []\r\n\r\n    //Functionality\r\n    //calc add digit\r\n    const addDigit = (x) => {\r\n        let hold = calc\r\n        let thisNum = hold.concat(x)\r\n        setBuyShares(parseFloat(thisNum))\r\n        setCalc(thisNum)\r\n        console.log(buyShares)\r\n        console.log(typeof buyShares)\r\n    }\r\n\r\n    const deleteDigit = () => {\r\n        const editedText = calc.slice(0, -1)\r\n        setBuyShares(parseFloat(editedText))\r\n        setCalc(editedText)\r\n        \r\n    }\r\n\r\n    const submitBuy = () => {\r\n        console.log(buyShares)\r\n        let buyShareInt = parseInt(buyShares)\r\n        if(asksArr1.length>0){shareCost = asksArr1[0].askPrice}\r\n        if(asksArr1.length>= buyShares){\r\n            for(let i = 1; i<buyShares; i++){\r\n                shareCost = shareCost + asksArr1[i].askPrice\r\n            }\r\n            if(!user.subscription){tradingCost = 1}\r\n            avgCost = shareCost / buyShares\r\n            totalCost = shareCost + tradingCost\r\n        }\r\n        let count = 0\r\n            user.shares.map(s => {\r\n                let share = s.substring(0, s.length - 4)\r\n                if(share == team.team){\r\n                    count++\r\n                }\r\n            })\r\n            let buyAmt = 7 - count\r\n            maxBuy = buyAmt\r\n        if(buyShareInt == buyShares){\r\n            if(asksArr1.length + 1 > buyShares){\r\n                if(totalCost <= user.cash){\r\n                    if(buyShares<=maxBuy){\r\n                        let answer = window.confirm(`Are you sure you want to buy ${buyShares} shares for an average cost of $${avgCost.toFixed(2)} per share, for a total of $${totalCost.toFixed(2)}? ${tradingCost != 0 ? `Includes a trading fee of $${tradingCost.toFixed(2)}`: ''}`)\r\n                        if(answer){\r\n                            alert(`You bought ${buyShares} shares for an average cost of $${avgCost.toFixed(2)} per share, for a total of $${totalCost.toFixed(2)}`)\r\n                            uploadingByAsk()\r\n                        }\r\n                        else{\r\n                            resetIt()\r\n                        }\r\n                    }\r\n                    else{\r\n                        alert(`Sorry, you can only own 7 shares of a specific team at the moment. ${maxBuy === 0 ? 'Since, you already own 7, it is not possible to buy more. We apologize for the inconvenience.' : `It is possible to buy ${maxBuy} more share(s).`}`)\r\n                        resetIt() \r\n                    }\r\n                }else{\r\n                    alert(`You dont have enough cash`)\r\n                    console.log(totalCost)\r\n                    resetIt()\r\n                }\r\n            }else{\r\n                alert(`Not enough available shares. There are only ${asksArr1.length} shares available.`)\r\n                resetIt()\r\n            }\r\n        }\r\n        else{\r\n            console.log(buyShares)\r\n            console.log(buyShareInt)\r\n            alert(`Sorry we don't do fractional trading. Please try again with a whole number.`)\r\n            resetIt()\r\n        }\r\n    }\r\n    \r\n    const getTotalCost = () => {\r\n        if(asksArr1.length>0){shareCost = asksArr1[0].askPrice}\r\n        if(asksArr1.length>= buyShares){\r\n            for(let i = 1; i<buyShares; i++){\r\n                shareCost = shareCost + asksArr1[i].askPrice\r\n            }\r\n            if(!user.subscription){tradingCost = 1}\r\n            avgCost = shareCost / buyShares\r\n            totalCost = shareCost + tradingCost\r\n        }\r\n    }\r\n    useEffect(() => {\r\n        getTotalCost()\r\n    }, [buyShares, asksArr1])\r\n\r\n    const checkShareAmt = () => {\r\n        if(user.shares){\r\n            let count = 0\r\n            user.shares.map(s => {\r\n                let share = s.substring(0, s.length - 4)\r\n                if(share == team.team){\r\n                    count++\r\n                }\r\n            })\r\n            let buyAmt = 7 - count\r\n            maxBuy = buyAmt\r\n        }\r\n    }\r\n    useEffect(() => {\r\n        checkShareAmt()\r\n    }, [user])\r\n\r\n    function uploadingByAsk(){\r\n        let transactionNum = (`000000000000${(Math.random() * 100000000000).toFixed(0)}`)\r\n        let transactionID = transactionNum.substring(transactionNum.length - 10, transactionNum.length)\r\n        var batch = db.batch()\r\n        for(let i = 0; i<buyShares; i++){\r\n            if(!asksArr1[i].subscription){\r\n                let num = asksArr1[i].askNum\r\n                if(num == 0){\r\n                    let thisRef7 = db.collection('Users').doc(asksArr1[i].askOwner)\r\n                    batch.update(thisRef7,{\r\n                        cash: firebase.firestore.FieldValue.increment(-tradingCost)\r\n                    })\r\n                }\r\n            }\r\n            let thisRef1 = db.collection('Shares').doc(asksArr1[i].askShare)\r\n            batch.update(thisRef1, {\r\n                currentAsk: null,\r\n                lastSoldPrice: asksArr1[i].askPrice,\r\n                onTradingBlock: false,\r\n                owner: user.email,\r\n                totalPayouts: 0\r\n            })\r\n            let thisRef2 = db.collection('Users').doc(asksArr1[i].askOwner)\r\n            batch.update(thisRef2, {\r\n                cash: firebase.firestore.FieldValue.increment(asksArr1[i].askPrice),\r\n                shares: firebase.firestore.FieldValue.arrayRemove(asksArr1[i].askShare)\r\n            })\r\n            let thisRef3 = db.collection('Users').doc(user.email)\r\n            batch.update(thisRef3, {\r\n                shares: firebase.firestore.FieldValue.arrayUnion(asksArr1[i].askShare)\r\n            })\r\n            let thisRef4 = db.collection('Asks').doc(`${asksArr1[i].askShare}-${asksArr1[i].askOwner}`)\r\n            batch.delete(thisRef4)\r\n            let newYearHigh = team.yearHigh > asksArr1[i].askPrice ? team.yearHigh : asksArr1[i].askPrice\r\n            let newYearLow = team.yearLow < asksArr1[i].askPrice ? team.yearLow : asksArr1[i].askPrice\r\n            let thisRef5 = db.collection('Teams').doc(team.team)\r\n            batch.update(thisRef5, {\r\n                asksAvailable: firebase.firestore.FieldValue.increment(-1),\r\n                totalAskPrice: firebase.firestore.FieldValue.increment(parseFloat(-asksArr1[i].askPrice)),\r\n                lastSoldPrice: asksArr1[i].askPrice,\r\n                yearHigh: newYearHigh,\r\n                yearLow: newYearLow\r\n            })\r\n            let date = moment().format('YYYYMMDD')\r\n            let thisRef8 = db.collection('Transactions').doc(`${date}-${asksArr1[i].askShare}-seller:${asksArr1[i].askOwner}-buyer:${user.email}-price:${asksArr1[i].askPrice}`)\r\n            batch.set(thisRef8, {\r\n                seller: asksArr1[i].askOwner,\r\n                buyer: user.email,\r\n                price: asksArr1[i].askPrice,\r\n                date: date,\r\n                time: firebase.firestore.Timestamp.now(),\r\n                sellerFee: !asksArr1[i].subscription,\r\n                buyerFee: !user.subscription,\r\n                share: asksArr1[i].askShare,\r\n                transactionID: transactionID,\r\n                type: 'buy',\r\n                oldPrice: team.lastSoldPrice\r\n            })\r\n        }\r\n        let thisRef6 = db.collection('Users').doc(user.email)\r\n        batch.update(thisRef6, {\r\n            cash: firebase.firestore.FieldValue.increment(-totalCost),\r\n        })\r\n        batch.commit().then(()=> {\r\n            return window.location.href = \"http://simbull.app\";\r\n        }).catch((error) => console.log(error));\r\n    }\r\n\r\n    const resetIt = () => {\r\n        //setBuyShares()\r\n        setBuyShares(0)\r\n        totalCost = 0\r\n        avgCost = 0\r\n        newLowestAskPrice = 0\r\n    }\r\n    const checkAsks = () => {\r\n        function compare(a, b) {\r\n            return a.askPrice - b.askPrice;\r\n          }\r\n        \r\n        db.collection('Asks').where('team', '==', team.team)\r\n            .onSnapshot(querySnapshot => {\r\n                let asksArr = []\r\n                querySnapshot.forEach(function(doc) {\r\n                    const data = doc.data()\r\n                    if(user.email != data.askOwner){\r\n                        asksArr.push(data)\r\n                    }    \r\n                });  \r\n                asksArr.sort(compare);\r\n                setAsksArr1(asksArr)\r\n                console.log(asksArr1)\r\n            })\r\n            \r\n    }\r\n\r\n    useEffect(() => {\r\n        checkAsks()\r\n    }, [])\r\n\r\n    return(\r\n        <div className=\"TradePopup\">\r\n            <div className=\"SellShare\">\r\n                <Link onClick={closeBuy}><i className=\"fa fa-times-circle\"></i></Link>\r\n                <div className=\"ss-title\">Buy</div>\r\n                <div className='ss-team'><img className=\"ss-img\"  src={`nba_jersey/${team.team}.png`} alt='team' /><span className=\"tc-name-sim\">sim</span>{team.team}</div>\r\n                <div className='ss-cash'>Cash Available: ${user.cash && user.cash.toFixed(2)}</div>\r\n                <div className=\"ss-shareAmt\">{calc ? calc : '0'}</div>\r\n                <div className=\"ss-btn-div\">\r\n                    <button className=\"ss-submit\" onClick={submitBuy}>Buy</button><br />\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"1\")}}>1</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"2\")}}>2</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"3\")}}>3</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"4\")}}>4</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"5\")}}>5</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"6\")}}>6</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"7\")}}>7</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"8\")}}>8</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"9\")}}>9</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"0\")}}>0</button>\r\n                    <button className=\"ss-btn-2\" onClick={()=>{deleteDigit()}}><i className=\"fa fa-arrow-left\"></i></button>\r\n                </div>\r\n            </div> \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default BuyShare"]},"metadata":{},"sourceType":"module"}