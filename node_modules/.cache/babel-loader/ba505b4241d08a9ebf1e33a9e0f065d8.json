{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'./functions.css';import{Link}from'react-router-dom';import{db}from'../../services/firebase';import firebase from'firebase';import moment from'moment';var CreateBid=function CreateBid(props){//props\nvar team=props.team;var user=props.user;var closeBid=props.closeBid;//states\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),calc=_useState2[0],setCalc=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),showShare=_useState4[0],setShowShare=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showPrice=_useState6[0],setShowPrice=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),bidPrice=_useState8[0],setBidPrice=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),bidShares=_useState10[0],setBidShares=_useState10[1];var _useState11=useState(7),_useState12=_slicedToArray(_useState11,2),maxBuy=_useState12[0],setMaxBuy=_useState12[1];var today=moment().format('YYYYMMDD');//Functionality\n//calc add digit\nvar addDigit=function addDigit(x){console.log(calc);if(x==='.'&&calc.substring(calc.length-1,calc.length)==='.'){return null;}else{if(showShare){var hold=calc;var thisNum=hold.concat(x);console.log(thisNum);setBidShares(parseFloat(thisNum));setCalc(thisNum);}else if(showPrice){var _hold=calc;var _thisNum=_hold.concat(x);console.log(_thisNum);setBidPrice(parseFloat(_thisNum));setCalc(_thisNum);}}};var deleteDigit=function deleteDigit(){if(showShare){var editedText=calc.slice(0,-1);setBidShares(parseFloat(editedText));setCalc(editedText);}else if(showPrice){var _editedText=calc.slice(0,-1);setBidPrice(parseFloat(_editedText));setCalc(_editedText);}};function createBid(){var numShares=0;var totalPrice=0;db.collection('Asks').where('team','==',team.team).get().then(function(snapshot){snapshot.forEach(function(doc){var data=doc.data();if(data.askOwner!=user.email){if(bidPrice>=data.askPrice){numShares++;if(numShares<=bidShares){totalPrice=totalPrice+data.askPrice;}}}});if(numShares>=bidShares&&totalPrice<=(bidShares*bidPrice).toFixed(2)){if(bidShares<=maxBuy){var stillCreate=window.confirm(\"There are enough open offers to sell to fill your order! You can buy the available shares for $\".concat((totalPrice/bidShares).toFixed(2),\" per share. Would you still like to create the offer to buy?\"));if(stillCreate){if(user.cash>bidPrice*bidShares+1){var batch=db.batch();for(var i=0;i<bidShares;i++){var thisRef=db.collection('Bids').doc(\"\".concat(team.team,\"-\").concat(user.email,\"-$\").concat(parseFloat(bidPrice),\"-\").concat(i));batch.set(thisRef,{bidOwner:user.email,bidPrice:parseFloat(bidPrice),bidTeam:team.team,bidNum:i,subscription:user.subscription,time:firebase.firestore.Timestamp.now(),date:today});}var newBidsAvailable=parseFloat(team.bidsAvailable)+parseFloat(bidShares);var newTotalBidPrice=team.totalBidPrice+bidShares*bidPrice;var newHighestBidPrice=bidPrice>team.highestBidPrice?bidPrice:team.highestBidPrice;var teamRef=db.collection('Teams').doc(team.team);batch.update(teamRef,{bidsAvailable:parseFloat(newBidsAvailable),totalBidPrice:parseFloat(newTotalBidPrice),highestBidPrice:parseFloat(newHighestBidPrice)});batch.commit().then(function(){alert(\"You created an offer to buy \".concat(bidShares,\" shares for a price of $\").concat(bidPrice,\" per share, for a total of $\").concat(bidPrice*bidShares,\".\"));window.location.href=\"http://simbull.app\";}).catch(function(error){return console.log(error);});}else{alert(\"You don't have enough cash to cover the offer to buy\");}}}else{alert(\"Sorry we can't create that bid for you because it put you over the maximum amount of shares for a single team. You can only create a bid for \".concat(maxBuy,\" shares.\"));}}else{if(user.cash>bidPrice*bidShares){if(bidShares<=maxBuy){if(window.confirm(\"Do you want to create an offer to buy \".concat(bidShares,\" shares for a price of $\").concat(bidPrice,\" per share, for a total of $\").concat(bidPrice*bidShares,\"?\"))){var batch=db.batch();for(var _i=0;_i<bidShares;_i++){var _thisRef=db.collection('Bids').doc(\"\".concat(team.team,\"-\").concat(user.email,\"-$\").concat(parseFloat(bidPrice),\"-\").concat(_i));batch.set(_thisRef,{bidOwner:user.email,bidPrice:parseFloat(bidPrice),bidTeam:team.team,bidNum:_i,subscription:user.subscription,time:firebase.firestore.Timestamp.now(),date:today});}var _newBidsAvailable=parseFloat(team.bidsAvailable)+parseFloat(bidShares);var _newTotalBidPrice=team.totalBidPrice+bidShares*bidPrice;var _newHighestBidPrice=bidPrice>team.highestBidPrice?bidPrice:team.highestBidPrice;var _teamRef=db.collection('Teams').doc(team.team);batch.update(_teamRef,{bidsAvailable:parseFloat(_newBidsAvailable),totalBidPrice:parseFloat(_newTotalBidPrice),highestBidPrice:parseFloat(_newHighestBidPrice)});batch.commit().then(function(){alert(\"You created an offer to buy \".concat(bidShares,\" shares for a price of $\").concat(bidPrice,\" per share, for a total of $\").concat(bidPrice*bidShares,\".\"));window.location.href=\"http://simbull.app\";}).catch(function(error){return console.log(error);});}}else{alert(\"Sorry we can't create that bid for you because it put you over the maximum amount of shares for a single team. You can only create a bid for \".concat(maxBuy,\" shares.\"));}}else{alert('You dont have enough cash to cover the offer to buy');}}}).catch(function(error){return console.log(error);});}var checkShareAmt=function checkShareAmt(){if(user.shares){var count=0;user.shares.map(function(s){var share=s.substring(0,s.length-4);if(share==team.team){count++;}});var buyAmt=7-count;setMaxBuy(buyAmt);}};useEffect(function(){checkShareAmt();},[user]);return/*#__PURE__*/_jsx(\"div\",{className:\"TradePopup\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"SellShare\",children:[/*#__PURE__*/_jsx(Link,{onClick:closeBid,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-times-circle\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"ss-title\",children:\"Offer to Buy\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-team\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"ss-img\",src:\"nba_jersey/\".concat(team.team,\".png\"),alt:\"team\"}),/*#__PURE__*/_jsx(\"span\",{className:\"tc-name-sim\",children:\"sim\"}),team.team]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-cash\",children:[\"Cash Available: $\",user.cash&&user.cash.toFixed(2)]}),showShare&&/*#__PURE__*/_jsxs(\"div\",{className:\"ss-shareAmt\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ss-share-label\",children:\"Shares:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"ss-shareAmt-underline\",children:calc?calc:'0'})]}),showPrice&&/*#__PURE__*/_jsxs(\"div\",{className:\"ss-shareAmt\",children:[/*#__PURE__*/_jsx(Link,{onClick:function onClick(){setShowPrice(false);setShowShare(true);setCalc('');setBidPrice();setBidShares();},children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-undo\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"ss-share-label\",children:\"Price:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"ss-shareAmt-underline\",children:calc?calc:'0.00'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-btn-div\",children:[showShare&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"ss-submit\",onClick:function onClick(){setShowPrice(true);setShowShare(false);setCalc('');},children:\"Next\"}),/*#__PURE__*/_jsx(\"br\",{})]}),showPrice&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"ss-submit\",onClick:createBid,children:\"Create Offer to Sell\"}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"1\");},children:\"1\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"2\");},children:\"2\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"3\");},children:\"3\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"4\");},children:\"4\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"5\");},children:\"5\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"6\");},children:\"6\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"7\");},children:\"7\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"8\");},children:\"8\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"9\");},children:\"9\"}),showPrice&&/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\".\");},children:\".\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"0\");},children:\"0\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn-2\",onClick:function onClick(){deleteDigit();},children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-arrow-left\"})})]})]})});};export default CreateBid;","map":{"version":3,"sources":["C:/Users/Dallas/Desktop/simbull-two/src/components/Functionality/CreateBid.js"],"names":["React","useState","useEffect","Link","db","firebase","moment","CreateBid","props","team","user","closeBid","calc","setCalc","showShare","setShowShare","showPrice","setShowPrice","bidPrice","setBidPrice","bidShares","setBidShares","maxBuy","setMaxBuy","today","format","addDigit","x","console","log","substring","length","hold","thisNum","concat","parseFloat","deleteDigit","editedText","slice","createBid","numShares","totalPrice","collection","where","get","then","snapshot","forEach","doc","data","askOwner","email","askPrice","toFixed","stillCreate","window","confirm","cash","batch","i","thisRef","set","bidOwner","bidTeam","bidNum","subscription","time","firestore","Timestamp","now","date","newBidsAvailable","bidsAvailable","newTotalBidPrice","totalBidPrice","newHighestBidPrice","highestBidPrice","teamRef","update","commit","alert","location","href","catch","error","checkShareAmt","shares","count","map","s","share","buyAmt"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport './functions.css'\r\nimport {Link} from 'react-router-dom'\r\nimport {db} from '../../services/firebase'\r\nimport firebase from 'firebase'\r\nimport moment from 'moment'\r\n\r\n\r\nconst CreateBid = (props) => {\r\n    //props\r\n    const team = props.team\r\n    const user = props.user\r\n    const closeBid = props.closeBid\r\n\r\n    //states\r\n    const [calc, setCalc] = useState('')\r\n    const [showShare, setShowShare] = useState(true)\r\n    const [showPrice, setShowPrice] = useState(false)\r\n    const [bidPrice, setBidPrice] = useState()\r\n    const [bidShares, setBidShares] = useState()\r\n    const [maxBuy, setMaxBuy] = useState(7)\r\n\r\n    let today = moment().format('YYYYMMDD')\r\n\r\n    //Functionality\r\n    //calc add digit\r\n    const addDigit = (x) => {\r\n        console.log(calc)\r\n        if(x === '.' && calc.substring(calc.length - 1, calc.length) === '.'){\r\n            return null\r\n        }else{\r\n            if(showShare){\r\n                let hold = calc\r\n                let thisNum = hold.concat(x)\r\n                console.log(thisNum)\r\n                setBidShares(parseFloat(thisNum))\r\n                setCalc(thisNum)\r\n            }else if(showPrice){\r\n                let hold = calc\r\n                let thisNum = hold.concat(x)\r\n                console.log(thisNum)\r\n                setBidPrice(parseFloat(thisNum))\r\n                setCalc(thisNum)\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    const deleteDigit = () => {\r\n        if(showShare){\r\n            const editedText = calc.slice(0, -1)\r\n            setBidShares(parseFloat(editedText))\r\n            setCalc(editedText)\r\n        }else if(showPrice){\r\n            const editedText = calc.slice(0, -1)\r\n            setBidPrice(parseFloat(editedText))\r\n            setCalc(editedText)\r\n        }\r\n        \r\n    }\r\n\r\n    function createBid() {\r\n        let numShares = 0\r\n        let totalPrice = 0\r\n        db.collection('Asks').where('team', '==', team.team).get().then((snapshot) => {\r\n            snapshot.forEach((doc) => {\r\n              const data = doc.data();\r\n              if(data.askOwner != user.email){\r\n                if(bidPrice >= data.askPrice){\r\n                    numShares++\r\n                    if(numShares <= bidShares){\r\n                      totalPrice = totalPrice + data.askPrice\r\n                  }\r\n                }\r\n              }\r\n            });\r\n            if(numShares >= bidShares && totalPrice <= (bidShares * bidPrice).toFixed(2)){\r\n                if(bidShares<=maxBuy){\r\n                    let stillCreate = window.confirm(`There are enough open offers to sell to fill your order! You can buy the available shares for $${(totalPrice/bidShares).toFixed(2)} per share. Would you still like to create the offer to buy?`)\r\n                    if(stillCreate){\r\n                        if(user.cash > (bidPrice * bidShares) + 1){\r\n                            var batch = db.batch()\r\n                            for(let i = 0; i < bidShares; i++) {\r\n                                let thisRef = db.collection('Bids').doc(`${team.team}-${user.email}-$${parseFloat(bidPrice)}-${i}`)\r\n                                batch.set(thisRef, {\r\n                                    bidOwner: user.email,\r\n                                    bidPrice: parseFloat(bidPrice),\r\n                                    bidTeam: team.team,\r\n                                    bidNum: i,\r\n                                    subscription: user.subscription,\r\n                                    time: firebase.firestore.Timestamp.now(),\r\n                                    date: today\r\n                                })\r\n                            }\r\n                            let newBidsAvailable = parseFloat(team.bidsAvailable) + parseFloat(bidShares)\r\n                            let newTotalBidPrice = team.totalBidPrice + (bidShares * bidPrice)\r\n                            let newHighestBidPrice = bidPrice > team.highestBidPrice ? bidPrice : team.highestBidPrice\r\n                            let teamRef = db.collection('Teams').doc(team.team)\r\n                            batch.update(teamRef, {\r\n                                bidsAvailable: parseFloat(newBidsAvailable),\r\n                                totalBidPrice: parseFloat(newTotalBidPrice),\r\n                                highestBidPrice: parseFloat(newHighestBidPrice)\r\n                            })\r\n                            batch.commit().then(()=> {\r\n                                alert(`You created an offer to buy ${bidShares} shares for a price of $${bidPrice} per share, for a total of $${bidPrice * bidShares}.`)\r\n                                window.location.href = \"http://simbull.app\";\r\n                            }).catch((error) => console.log(error));\r\n                        }else{\r\n                            alert(`You don't have enough cash to cover the offer to buy`)\r\n                        }\r\n                    }\r\n                }\r\n                else{\r\n                    alert(`Sorry we can't create that bid for you because it put you over the maximum amount of shares for a single team. You can only create a bid for ${maxBuy} shares.`)\r\n                }\r\n                   \r\n            }\r\n            else{\r\n                if(user.cash > (bidPrice * bidShares)){\r\n                    if(bidShares<=maxBuy){\r\n                        if(window.confirm(`Do you want to create an offer to buy ${bidShares} shares for a price of $${bidPrice} per share, for a total of $${bidPrice * bidShares}?`)){\r\n                            var batch = db.batch()\r\n                            for(let i = 0; i < bidShares; i++) {\r\n                                let thisRef = db.collection('Bids').doc(`${team.team}-${user.email}-$${parseFloat(bidPrice)}-${i}`)\r\n                                batch.set(thisRef, {\r\n                                    bidOwner: user.email,\r\n                                    bidPrice: parseFloat(bidPrice),\r\n                                    bidTeam: team.team,\r\n                                    bidNum: i,\r\n                                    subscription: user.subscription,\r\n                                    time: firebase.firestore.Timestamp.now(),\r\n                                    date: today\r\n                                })\r\n                            }\r\n                            let newBidsAvailable = parseFloat(team.bidsAvailable) + parseFloat(bidShares)\r\n                            let newTotalBidPrice = team.totalBidPrice + (bidShares * bidPrice)\r\n                            let newHighestBidPrice = bidPrice > team.highestBidPrice ? bidPrice : team.highestBidPrice\r\n                            let teamRef = db.collection('Teams').doc(team.team)\r\n                            batch.update(teamRef, {\r\n                                bidsAvailable: parseFloat(newBidsAvailable),\r\n                                totalBidPrice: parseFloat(newTotalBidPrice),\r\n                                highestBidPrice: parseFloat(newHighestBidPrice)\r\n                            })\r\n                            batch.commit().then(()=> {\r\n                                alert(`You created an offer to buy ${bidShares} shares for a price of $${bidPrice} per share, for a total of $${bidPrice * bidShares}.`)\r\n                                window.location.href = \"http://simbull.app\";\r\n                            }).catch((error) => console.log(error));\r\n                        }\r\n                    }\r\n                    else{\r\n                        alert(`Sorry we can't create that bid for you because it put you over the maximum amount of shares for a single team. You can only create a bid for ${maxBuy} shares.`)\r\n                    }\r\n                }else{\r\n                    alert('You dont have enough cash to cover the offer to buy')\r\n                }\r\n            }\r\n          })\r\n          .catch((error) => console.log(error));\r\n         \r\n    }\r\n\r\n    const checkShareAmt = () => {\r\n        if(user.shares){\r\n            let count = 0\r\n            user.shares.map(s => {\r\n                let share = s.substring(0, s.length - 4)\r\n                if(share == team.team){\r\n                    count++\r\n                }\r\n            })\r\n            let buyAmt = 7 - count\r\n            setMaxBuy(buyAmt)\r\n        }\r\n    }\r\n    useEffect(() => {\r\n        checkShareAmt()\r\n    }, [user])\r\n\r\n    return(\r\n        <div className=\"TradePopup\">\r\n            <div className=\"SellShare\">\r\n                <Link onClick={closeBid}><i className=\"fa fa-times-circle\"></i></Link>\r\n                <div className=\"ss-title\">Offer to Buy</div>\r\n                <div className='ss-team'><img className=\"ss-img\"  src={`nba_jersey/${team.team}.png`} alt='team' /><span className=\"tc-name-sim\">sim</span>{team.team}</div>\r\n                <div className='ss-cash'>Cash Available: ${user.cash && user.cash.toFixed(2)}</div>\r\n                {showShare && <div className=\"ss-shareAmt\"><span className=\"ss-share-label\">Shares:</span> <span className=\"ss-shareAmt-underline\">{calc ? calc : '0'}</span></div>}\r\n                {showPrice && <div className=\"ss-shareAmt\"><Link onClick={()=>{setShowPrice(false);setShowShare(true);setCalc('');setBidPrice();setBidShares()}}><i className=\"fa fa-undo\"></i></Link><span className=\"ss-share-label\">Price:</span> <span className=\"ss-shareAmt-underline\">{calc ? calc : '0.00'}</span></div>}\r\n                <div className=\"ss-btn-div\">\r\n                    {showShare && <><button className=\"ss-submit\" onClick={()=>{setShowPrice(true);setShowShare(false);setCalc('')}}>Next</button><br /></>}\r\n                    {showPrice && <><button className=\"ss-submit\" onClick={createBid}>Create Offer to Sell</button><br /></>}\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"1\")}}>1</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"2\")}}>2</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"3\")}}>3</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"4\")}}>4</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"5\")}}>5</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"6\")}}>6</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"7\")}}>7</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"8\")}}>8</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"9\")}}>9</button>\r\n                    {showPrice && <button className=\"ss-btn\" onClick={()=>{addDigit(\".\")}}>.</button>}\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"0\")}}>0</button>\r\n                    <button className=\"ss-btn-2\" onClick={()=>{deleteDigit()}}><i className=\"fa fa-arrow-left\"></i></button>\r\n                </div>\r\n            </div> \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default CreateBid"]},"metadata":{},"sourceType":"module"}