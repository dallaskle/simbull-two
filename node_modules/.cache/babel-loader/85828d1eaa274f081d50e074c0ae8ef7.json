{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _asyncToGenerator from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Dallas/Desktop/simbull-two/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'./functions.css';import{Link}from'react-router-dom';import{db}from'../../services/firebase';import firebase from'firebase';import moment from'moment';var SellShare=function SellShare(props){//props\nvar shares=props.shares;var team=props.team;var user=props.user;var closeSell=props.closeSell;//states\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),calc=_useState2[0],setCalc=_useState2[1];var totalCost=0;var shareCost=0;var tradingCost=0;var newHighestBidPrice=0;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),sharesToSell=_useState4[0],setSharesToSell=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),sellShares=_useState6[0],setSellShares=_useState6[1];var handleSellShares=function handleSellShares(e){setSellShares(e.target.value);};var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),bidsArr=_useState8[0],setBidsArr=_useState8[1];useEffect(function(){getBids();},[props.bidsArr]);var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),amountSharesToSell=_useState10[0],setAmountSharesToSell=_useState10[1];//Functionality\n//calc add digit\nvar addDigit=function addDigit(x){var hold=calc;var thisNum=hold.concat(x);setSellShares(parseFloat(thisNum));setCalc(thisNum);};var deleteDigit=function deleteDigit(){var editedText=calc.slice(0,-1);var thisNum=parseFloat(editedText);setSellShares(thisNum);setCalc(editedText);};function getBids(){if(props.bidsArr){var bidOwners=[];var bidOwnersBidsAmt={};var ownersCashAmt={};//get bid owners and thier total bid amount\nprops.bidsArr.map(function(b){if(user.email!==b.bidOwner){if(bidOwnersBidsAmt[b.bidOwner]){bidOwnersBidsAmt[b.bidOwner]=bidOwnersBidsAmt[b.bidOwner]+b.bidPrice;}else{bidOwnersBidsAmt[b.bidOwner]=b.bidPrice;bidOwners.push(b.bidOwner);console.log(b.bidOwner);}}});console.log(bidOwners);console.log(bidOwnersBidsAmt);//get bid owners total cash\ndb.collection('Users').get().then(function(snapshot){snapshot.forEach(function(doc){var data=doc.data();console.log(bidOwners);if(bidOwners.includes(data.email.toString())){console.log('here');console.log(ownersCashAmt);if(!ownersCashAmt[data.email]){ownersCashAmt[data.email]=data.cash;}}console.log(data.email);console.log(ownersCashAmt[data.email]);console.log(ownersCashAmt[data.cash]);},function(error){console.log(error);});console.log('there');console.log(ownersCashAmt);return ownersCashAmt;}).then(function(result){//eliminating users from bidOwners Array if they don't have enough cash to cover their bids \nbidOwners.map(function(o){if(bidOwnersBidsAmt[o]>ownersCashAmt[o]){var ind=bidOwners.indexOf(o);bidOwners.splice(ind,1);}});return bidOwners;}).then(function(result){//repopulating the bids array with bids only from users with enough cash\nvar bids1=[];props.bidsArr.map(function(b){if(bidOwners.includes(b.bidOwner)){bids1.push(b);}});console.log(bids1);setBidsArr(bids1);});}}var getTotalCost=function getTotalCost(){totalCost=0;shareCost=0;if(bidsArr.length>0&bidsArr.length>=sellShares){for(var i=0;i<sellShares;i++){var holder=shareCost+bidsArr[i].bidPrice;shareCost=holder;}if(!user.subscription){tradingCost=1;}totalCost=shareCost-tradingCost;}};useEffect(function(){getTotalCost();},[sellShares]);var getSharesToSell=function getSharesToSell(){var sharesToSell1=[];user.shares.map(function(s){if(s.substring(0,s.length-4)==team.team){sharesToSell1.push(s);}});setSharesToSell(sharesToSell1);};useEffect(function(){getSharesToSell();},[props.bidsArr]);var submitSell=function submitSell(){var sellSharesInt=parseInt(sellShares);if(sellShares==sellSharesInt){if(amountSharesToSell<sellShares){alert(\"You don't own enough shares. You only own \".concat(amountSharesToSell,\" shares.\"));}else{if(bidsArr.length>=sellShares&sellShares!=0){var answer=window.confirm(\"Sell \".concat(sellShares,\" shares for $\").concat(shareCost/sellShares,\" per share, for a total of $\").concat(totalCost,\"? \").concat(!user.subscription?\"Includes a trading fee of $\".concat(tradingCost.toFixed(2),\".\"):''));if(answer){uploadByBid();}}else{alert(\"There are not enough open bids to fill your order. Please try a smaller order or make an offer to sell. There are only \".concat(bidsArr.length,\" available. \"));}}}else{alert(\"Sorry we don't do fractional trading. Please try again with a whole number.\");}};var checkForShares=function checkForShares(){var sharesOwned=0;user.shares.map(function(s){var newS=s.substring(0,s.length-4);if(newS==team.team){sharesOwned++;}});setAmountSharesToSell(sharesOwned);};useEffect(function(){checkForShares();},[props.user]);function uploadByBid(){return _uploadByBid.apply(this,arguments);}function _uploadByBid(){_uploadByBid=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var transactionNum,transactionID,batch,i,num,thisRef7,thisRef1,thisRef2,thisRef3,thisRef4,newYearHigh,newYearLow,thisRef5,date,thisRef8,thisRef6;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:transactionNum=\"000000000000\".concat((Math.random()*100000000000).toFixed(0));transactionID=transactionNum.substring(transactionNum.length-10,transactionNum.length);batch=db.batch();for(i=0;i<sellShares;i++){if(!bidsArr[i].subscription){num=bidsArr[i].bidNum;if(num==0){thisRef7=db.collection('Users').doc(bidsArr[i].bidOwner);batch.update(thisRef7,{cash:firebase.firestore.FieldValue.increment(-tradingCost)});}}thisRef1=db.collection('Shares').doc(sharesToSell[i]);batch.update(thisRef1,{currentAsk:null,lastSoldPrice:bidsArr[i].bidPrice,owner:bidsArr[i].bidOwner,onTradingBlock:false,totalPayouts:0});thisRef2=db.collection('Users').doc(bidsArr[i].bidOwner);batch.update(thisRef2,{cash:firebase.firestore.FieldValue.increment(-bidsArr[i].bidPrice),shares:firebase.firestore.FieldValue.arrayUnion(sharesToSell[i])});thisRef3=db.collection('Users').doc(user.email);batch.update(thisRef3,{shares:firebase.firestore.FieldValue.arrayRemove(sharesToSell[i])});thisRef4=db.collection('Bids').doc(\"\".concat(bidsArr[i].bidTeam,\"-\").concat(bidsArr[i].bidOwner,\"-$\").concat(bidsArr[i].bidPrice,\"-\").concat(bidsArr[i].bidNum));batch.delete(thisRef4);newYearHigh=team.yearHigh>bidsArr[i].bidPrice?team.yearHigh:bidsArr[i].bidPrice;newYearLow=team.yearLow<bidsArr[i].bidPrice?team.yearLow:bidsArr[i].bidPrice;thisRef5=db.collection('Teams').doc(team.team);batch.update(thisRef5,{bidsAvailable:firebase.firestore.FieldValue.increment(-1),totalBidPrice:firebase.firestore.FieldValue.increment(parseFloat(-bidsArr[i].bidPrice)),lastSoldPrice:bidsArr[i].bidPrice,yearHigh:newYearHigh,yearLow:newYearLow});date=moment().format('YYYYMMDD');thisRef8=db.collection('Transactions').doc(\"\".concat(date,\"-\").concat(sharesToSell[i],\"-seller:\").concat(user.email,\"-buyer:\").concat(user.email,\"-price:\").concat(bidsArr[i].bidPrice));batch.set(thisRef8,{seller:user.email,buyer:bidsArr[i].bidOwner,price:bidsArr[i].bidPrice,date:date,time:firebase.firestore.Timestamp.now(),sellerFee:!user.subscription,buyerFee:!bidsArr[i].subscription,share:sharesToSell[i],transactionID:transactionID,type:'sell',oldPrice:team.lastSoldPrice});}thisRef6=db.collection('Users').doc(user.email);batch.update(thisRef6,{cash:firebase.firestore.FieldValue.increment(totalCost)});db.collection('Asks').where('team','==',team.team).where('askOwner','==',user.email).get().then(function(snapshot){var asks1=[];snapshot.forEach(function(doc){var data=doc.data();for(var _i=0;_i<sellShares;_i++){if(data.askShare==sharesToSell[_i]){asks1.push(data);}}});asks1.map(function(s){var deleteRef=db.collection('Asks').doc(\"\".concat(s.askShare,\"-\").concat(user.email));batch.delete(deleteRef);});batch.commit().then(function(){alert(\"You sold \".concat(sellShares,\" shares for $\").concat(totalCost));window.location.href=\"http://simbull.app\";});}).catch(function(error){return console.log(error);});case 7:case\"end\":return _context.stop();}}},_callee);}));return _uploadByBid.apply(this,arguments);}return/*#__PURE__*/_jsx(\"div\",{className:\"TradePopup\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"SellShare\",children:[/*#__PURE__*/_jsx(Link,{onClick:closeSell,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-times-circle\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"ss-title\",children:\"Sell\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-team\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"ss-img\",src:\"nba_jersey/\".concat(team.team,\".png\"),alt:\"team\"}),/*#__PURE__*/_jsx(\"span\",{className:\"tc-name-sim\",children:\"sim\"}),team.team]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-shares\",children:[\"You own \",shares,\" shares\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"ss-shareAmt underline\",children:calc?calc:'0'}),/*#__PURE__*/_jsxs(\"div\",{className:\"ss-btn-div\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"ss-submit\",onClick:submitSell,children:\"Sell\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"1\");},children:\"1\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"2\");},children:\"2\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"3\");},children:\"3\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"4\");},children:\"4\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"5\");},children:\"5\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"6\");},children:\"6\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"7\");},children:\"7\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"8\");},children:\"8\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"9\");},children:\"9\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn\",onClick:function onClick(){addDigit(\"0\");},children:\"0\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ss-btn-2\",onClick:function onClick(){deleteDigit();},children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-arrow-left\"})})]})]})});};export default SellShare;","map":{"version":3,"sources":["C:/Users/Dallas/Desktop/simbull-two/src/components/Functionality/SellShare.js"],"names":["React","useState","useEffect","Link","db","firebase","moment","SellShare","props","shares","team","user","closeSell","calc","setCalc","totalCost","shareCost","tradingCost","newHighestBidPrice","sharesToSell","setSharesToSell","sellShares","setSellShares","handleSellShares","e","target","value","bidsArr","setBidsArr","getBids","amountSharesToSell","setAmountSharesToSell","addDigit","x","hold","thisNum","concat","parseFloat","deleteDigit","editedText","slice","bidOwners","bidOwnersBidsAmt","ownersCashAmt","map","b","email","bidOwner","bidPrice","push","console","log","collection","get","then","snapshot","forEach","doc","data","includes","toString","cash","error","result","o","ind","indexOf","splice","bids1","getTotalCost","length","i","holder","subscription","getSharesToSell","sharesToSell1","s","substring","submitSell","sellSharesInt","parseInt","alert","answer","window","confirm","toFixed","uploadByBid","checkForShares","sharesOwned","newS","transactionNum","Math","random","transactionID","batch","num","bidNum","thisRef7","update","firestore","FieldValue","increment","thisRef1","currentAsk","lastSoldPrice","owner","onTradingBlock","totalPayouts","thisRef2","arrayUnion","thisRef3","arrayRemove","thisRef4","bidTeam","delete","newYearHigh","yearHigh","newYearLow","yearLow","thisRef5","bidsAvailable","totalBidPrice","date","format","thisRef8","set","seller","buyer","price","time","Timestamp","now","sellerFee","buyerFee","share","type","oldPrice","thisRef6","where","asks1","askShare","deleteRef","commit","location","href","catch"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport './functions.css'\r\nimport {Link} from 'react-router-dom'\r\nimport {db} from '../../services/firebase'\r\nimport firebase from 'firebase'\r\nimport moment from 'moment'\r\n\r\nconst SellShare = (props) => {\r\n    //props\r\n    const shares = props.shares\r\n    const team = props.team\r\n    const user = props.user\r\n    const closeSell = props.closeSell\r\n\r\n\r\n    //states\r\n    const [calc, setCalc] = useState('')\r\n\r\n    let totalCost = 0\r\n    let shareCost = 0\r\n    let tradingCost = 0\r\n    let newHighestBidPrice = 0\r\n\r\n    const [sharesToSell, setSharesToSell] = useState([])\r\n    const [sellShares, setSellShares] = useState()\r\n    const handleSellShares = (e) => {setSellShares(e.target.value)}\r\n    const [bidsArr, setBidsArr] = useState([])\r\n    useEffect(() => {getBids()}, [props.bidsArr])\r\n    const [amountSharesToSell, setAmountSharesToSell] = useState(0)\r\n\r\n    //Functionality\r\n    //calc add digit\r\n    const addDigit = (x) => {\r\n        let hold = calc\r\n        let thisNum = hold.concat(x)\r\n        setSellShares(parseFloat(thisNum))\r\n        setCalc(thisNum)\r\n    }\r\n\r\n    const deleteDigit = () => {\r\n        const editedText = calc.slice(0, -1)\r\n        let thisNum = parseFloat(editedText)\r\n        setSellShares(thisNum)\r\n        setCalc(editedText)\r\n    }\r\n\r\n    function getBids() {\r\n        if(props.bidsArr){\r\n            const bidOwners = []\r\n            const bidOwnersBidsAmt = {}\r\n            const ownersCashAmt = {}\r\n            //get bid owners and thier total bid amount\r\n            props.bidsArr.map( b => {\r\n                if(user.email !== b.bidOwner){\r\n                    if (bidOwnersBidsAmt[b.bidOwner]) {\r\n                        bidOwnersBidsAmt[b.bidOwner] = bidOwnersBidsAmt[b.bidOwner] + b.bidPrice;\r\n                    } \r\n                    else {\r\n                        bidOwnersBidsAmt[b.bidOwner] = b.bidPrice;\r\n                        bidOwners.push(b.bidOwner)\r\n                        console.log(b.bidOwner)\r\n                    }\r\n                }\r\n            })\r\n            console.log(bidOwners)\r\n            console.log(bidOwnersBidsAmt)\r\n            //get bid owners total cash\r\n            db.collection('Users').get().then((snapshot) => {\r\n                snapshot.forEach(doc => {\r\n                    const data = doc.data()\r\n                    console.log(bidOwners)\r\n                    if(bidOwners.includes(data.email.toString())){\r\n                        console.log('here')\r\n                        console.log(ownersCashAmt)\r\n                        if(!ownersCashAmt[data.email]){\r\n                            ownersCashAmt[data.email] = data.cash\r\n                        }\r\n                    }\r\n                    console.log(data.email)\r\n                    console.log(ownersCashAmt[data.email])\r\n                    console.log(ownersCashAmt[data.cash])\r\n                }, error => {console.log(error)})\r\n                console.log('there')\r\n                console.log(ownersCashAmt)\r\n                return ownersCashAmt\r\n            }).then((result) => {\r\n                //eliminating users from bidOwners Array if they don't have enough cash to cover their bids \r\n                bidOwners.map( o => {\r\n                    if(bidOwnersBidsAmt[o] >  ownersCashAmt[o]){\r\n                    let ind = bidOwners.indexOf(o)\r\n                    bidOwners.splice(ind, 1)\r\n                    }\r\n                })\r\n                return bidOwners\r\n            }).then((result) => {\r\n                //repopulating the bids array with bids only from users with enough cash\r\n                const bids1 = []\r\n                props.bidsArr.map(b => {\r\n                if(bidOwners.includes(b.bidOwner)){\r\n                    bids1.push(b)\r\n                }\r\n                })   \r\n                console.log(bids1) \r\n                setBidsArr(bids1)\r\n            })\r\n            \r\n        }\r\n    }\r\n\r\n    const getTotalCost = () => {\r\n        totalCost = 0\r\n        shareCost = 0\r\n        if(bidsArr.length > 0 & bidsArr.length>= sellShares){\r\n            for(let i = 0; i < sellShares; i++){\r\n                let holder = shareCost + bidsArr[i].bidPrice\r\n                shareCost = holder\r\n            }\r\n            if(!user.subscription){\r\n                tradingCost = 1\r\n            }\r\n            totalCost = shareCost - tradingCost\r\n        }\r\n\r\n    }\r\n    useEffect(() => {getTotalCost()}, [sellShares])\r\n    const getSharesToSell = () => {\r\n        const sharesToSell1 = []\r\n        user.shares.map(s => {\r\n            if(s.substring(0, s.length-4) == team.team){\r\n                sharesToSell1.push(s)\r\n            }\r\n        })\r\n        setSharesToSell(sharesToSell1)\r\n    }\r\n    useEffect(() => {getSharesToSell()}, [props.bidsArr])\r\n\r\n    const submitSell = () => {\r\n        let sellSharesInt = parseInt(sellShares)\r\n        if(sellShares == sellSharesInt){\r\n            if(amountSharesToSell<sellShares){\r\n                alert(`You don't own enough shares. You only own ${amountSharesToSell} shares.`)\r\n            }\r\n            else{\r\n                if(bidsArr.length >= sellShares & sellShares != 0){\r\n                    let answer = window.confirm(`Sell ${sellShares} shares for $${shareCost/sellShares} per share, for a total of $${totalCost}? ${!user.subscription ? `Includes a trading fee of $${tradingCost.toFixed(2)}.` : ''}`)\r\n                    if(answer){\r\n                        uploadByBid()\r\n                    }\r\n                }\r\n                else{\r\n                    alert(`There are not enough open bids to fill your order. Please try a smaller order or make an offer to sell. There are only ${bidsArr.length} available. `)\r\n                }\r\n            }\r\n        }\r\n        else{\r\n            alert(`Sorry we don't do fractional trading. Please try again with a whole number.`)\r\n        }\r\n        \r\n    }\r\n\r\n    const checkForShares = () =>{\r\n        let sharesOwned = 0\r\n        user.shares.map(s => {\r\n            let newS = s.substring(0, s.length - 4)\r\n            if(newS == team.team){\r\n                sharesOwned++\r\n            }\r\n        })\r\n        setAmountSharesToSell(sharesOwned)\r\n    }\r\n    useEffect(() => {\r\n        checkForShares()\r\n    }, [props.user])\r\n\r\n    async function uploadByBid() {\r\n        let transactionNum = (`000000000000${(Math.random() * 100000000000).toFixed(0)}`)\r\n        let transactionID = transactionNum.substring(transactionNum.length - 10, transactionNum.length)\r\n        var batch = db.batch()\r\n        for(let i=0; i< sellShares; i++){\r\n            if(!bidsArr[i].subscription){\r\n                let num = bidsArr[i].bidNum\r\n                if(num == 0){\r\n                    let thisRef7 = db.collection('Users').doc(bidsArr[i].bidOwner)\r\n                    batch.update(thisRef7,{\r\n                        cash: firebase.firestore.FieldValue.increment(-tradingCost)\r\n                    })\r\n                }\r\n            }\r\n            let thisRef1 = db.collection('Shares').doc(sharesToSell[i])\r\n            batch.update(thisRef1,{\r\n                currentAsk: null,\r\n                lastSoldPrice: bidsArr[i].bidPrice,\r\n                owner: bidsArr[i].bidOwner,\r\n                onTradingBlock: false,\r\n                totalPayouts: 0\r\n            })\r\n            let thisRef2 = db.collection('Users').doc(bidsArr[i].bidOwner)\r\n            batch.update(thisRef2,{\r\n                cash: firebase.firestore.FieldValue.increment(-bidsArr[i].bidPrice),\r\n                shares: firebase.firestore.FieldValue.arrayUnion(sharesToSell[i])\r\n            })\r\n            let thisRef3 = db.collection('Users').doc(user.email)\r\n            batch.update(thisRef3,{\r\n                shares: firebase.firestore.FieldValue.arrayRemove(sharesToSell[i])\r\n            })\r\n            let thisRef4 = db.collection('Bids').doc(`${bidsArr[i].bidTeam}-${bidsArr[i].bidOwner}-$${bidsArr[i].bidPrice}-${bidsArr[i].bidNum}`)\r\n            batch.delete(thisRef4)\r\n            let newYearHigh = team.yearHigh > bidsArr[i].bidPrice ? team.yearHigh : bidsArr[i].bidPrice\r\n            let newYearLow = team.yearLow < bidsArr[i].bidPrice ? team.yearLow : bidsArr[i].bidPrice\r\n            let thisRef5 = db.collection('Teams').doc(team.team)\r\n            batch.update(thisRef5, {\r\n                bidsAvailable: firebase.firestore.FieldValue.increment(-1),\r\n                totalBidPrice: firebase.firestore.FieldValue.increment(parseFloat(-bidsArr[i].bidPrice)),\r\n                lastSoldPrice: bidsArr[i].bidPrice,\r\n                yearHigh: newYearHigh,\r\n                yearLow: newYearLow\r\n            })\r\n            let date = moment().format('YYYYMMDD')\r\n            let thisRef8 = db.collection('Transactions').doc(`${date}-${sharesToSell[i]}-seller:${user.email}-buyer:${user.email}-price:${bidsArr[i].bidPrice}`)\r\n            batch.set(thisRef8, {\r\n                seller: user.email,\r\n                buyer: bidsArr[i].bidOwner,\r\n                price: bidsArr[i].bidPrice,\r\n                date: date,\r\n                time: firebase.firestore.Timestamp.now(),\r\n                sellerFee: !user.subscription,\r\n                buyerFee: !bidsArr[i].subscription,\r\n                share: sharesToSell[i],\r\n                transactionID: transactionID,\r\n                type: 'sell',\r\n                oldPrice: team.lastSoldPrice\r\n            })\r\n        }\r\n        let thisRef6 = db.collection('Users').doc(user.email)\r\n        batch.update(thisRef6, {\r\n            cash: firebase.firestore.FieldValue.increment(totalCost),\r\n        })\r\n        db.collection('Asks').where('team', '==', team.team).where('askOwner', '==', user.email).get().then((snapshot) => {\r\n            const asks1 = [];\r\n            snapshot.forEach((doc) => {\r\n              const data = doc.data();\r\n              for(let i = 0; i < sellShares; i++){\r\n                  if(data.askShare == sharesToSell[i]){\r\n                    asks1.push(data);\r\n                  }\r\n              }\r\n            });\r\n            asks1.map(s => {\r\n                let deleteRef = db.collection('Asks').doc(`${s.askShare}-${user.email}`)\r\n                batch.delete(deleteRef)\r\n            })\r\n            batch.commit().then(()=> {\r\n                alert(`You sold ${sellShares} shares for $${totalCost}`)\r\n                window.location.href = \"http://simbull.app\";\r\n            })\r\n            }).catch((error) => console.log(error))\r\n    }\r\n\r\n\r\n    return(\r\n        <div className=\"TradePopup\">\r\n            <div className=\"SellShare\">\r\n                <Link onClick={closeSell}><i className=\"fa fa-times-circle\"></i></Link>\r\n                <div className=\"ss-title\">Sell</div>\r\n                <div className='ss-team'><img className=\"ss-img\"  src={`nba_jersey/${team.team}.png`} alt='team' /><span className=\"tc-name-sim\">sim</span>{team.team}</div>\r\n                <div className='ss-shares'>You own {shares} shares</div>\r\n                <div className=\"ss-shareAmt underline\">{calc ? calc : '0'}</div>\r\n                <div className=\"ss-btn-div\">\r\n                    <button className=\"ss-submit\" onClick={submitSell}>Sell</button><br />\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"1\")}}>1</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"2\")}}>2</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"3\")}}>3</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"4\")}}>4</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"5\")}}>5</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"6\")}}>6</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"7\")}}>7</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"8\")}}>8</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"9\")}}>9</button>\r\n                    <button className=\"ss-btn\" onClick={()=>{addDigit(\"0\")}}>0</button>\r\n                    <button className=\"ss-btn-2\" onClick={()=>{deleteDigit()}}><i className=\"fa fa-arrow-left\"></i></button>\r\n                </div>\r\n            </div> \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default SellShare"]},"metadata":{},"sourceType":"module"}